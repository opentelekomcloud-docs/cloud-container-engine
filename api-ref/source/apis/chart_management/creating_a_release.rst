:original_name: CreateRelease.html

.. _CreateRelease:

Creating a Release
==================

Function
--------

This API is used to create a release.

URI
---

POST /cce/cam/v3/clusters/{cluster_id}/releases

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+--------------------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                                              |
   +============+===========+========+==========================================================================================================================+
   | cluster_id | Yes       | String | Cluster ID. For details about how to obtain the value, see :ref:`How to Obtain Parameters in the API URI <cce_02_0271>`. |
   +------------+-----------+--------+--------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                                                     |
   +=================+=================+=================+=================================================================================================================================================================================================================================================+
   | Content-Type    | Yes             | String          | Details:                                                                                                                                                                                                                                        |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | Request body type or format.                                                                                                                                                                                                                    |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | Constraints:                                                                                                                                                                                                                                    |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | The GET method is not verified.                                                                                                                                                                                                                 |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | Options:                                                                                                                                                                                                                                        |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | -  application/json                                                                                                                                                                                                                             |
   |                 |                 |                 | -  application/json;charset=utf-8                                                                                                                                                                                                               |
   |                 |                 |                 | -  application/x-pem-file                                                                                                                                                                                                                       |
   |                 |                 |                 | -  multipart/form-data (It can be used when the **FormData** parameter exists.)                                                                                                                                                                 |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | Default value:                                                                                                                                                                                                                                  |
   |                 |                 |                 |                                                                                                                                                                                                                                                 |
   |                 |                 |                 | N/A                                                                                                                                                                                                                                             |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | X-Auth-Token    | Yes             | String          | Requests for calling an API can be authenticated using either a token or AK/SK. If token-based authentication is used, this parameter is mandatory and must be set to a user token. For details, see :ref:`API Usage Guidelines <cce_02_0004>`. |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 3** Request body parameters

   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | Parameter   | Mandatory | Type                                                                                                          | Description                                |
   +=============+===========+===============================================================================================================+============================================+
   | chart_id    | Yes       | String                                                                                                        | Chart ID                                   |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | description | No        | String                                                                                                        | Release description                        |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | name        | Yes       | String                                                                                                        | Release name                               |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | namespace   | Yes       | String                                                                                                        | Namespace to which a chart release belongs |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | version     | Yes       | String                                                                                                        | Release version                            |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | parameters  | No        | :ref:`ReleaseReqBodyParams <createrelease__en-us_topic_0000001896129313_request_releasereqbodyparams>` object | Release parameters                         |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+
   | values      | Yes       | :ref:`values <createrelease__en-us_topic_0000001896129313_request_values>` object                             | Release value                              |
   +-------------+-----------+---------------------------------------------------------------------------------------------------------------+--------------------------------------------+

.. _createrelease__en-us_topic_0000001896129313_request_releasereqbodyparams:

.. table:: **Table 4** ReleaseReqBodyParams

   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory | Type    | Description                                                                                            |
   +=================+===========+=========+========================================================================================================+
   | dry_run         | No        | Boolean | After this function is enabled, only chart parameters are verified, and installation is not performed. |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | name_template   | No        | String  | Release name template                                                                                  |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | no_hooks        | No        | Boolean | Whether to disable hooks during installation                                                           |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | replace         | No        | Boolean | Whether to replace the release with the same name                                                      |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | recreate        | No        | Boolean | Whether to rebuild the release                                                                         |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | reset_values    | No        | Boolean | Whether to reset values during an update                                                               |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | release_version | No        | Integer | Version of the rollback release                                                                        |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+
   | include_hooks   | No        | Boolean | Enable hooks during an update or deletion.                                                             |
   +-----------------+-----------+---------+--------------------------------------------------------------------------------------------------------+

.. _createrelease__en-us_topic_0000001896129313_request_values:

.. table:: **Table 5** values

   =============== ========= ====== =================
   Parameter       Mandatory Type   Description
   =============== ========= ====== =================
   imagePullPolicy No        String Image pull policy
   imageTag        No        String Image tag
   =============== ========= ====== =================

Response Parameters
-------------------

**Status code: 201**

.. table:: **Table 6** Response body parameters

   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                                                   |
   +=======================+=======================+===============================================================================================================================================+
   | chart_name            | String                | Chart name                                                                                                                                    |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | chart_public          | Boolean               | Whether the chart is public                                                                                                                   |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | chart_version         | String                | Chart version                                                                                                                                 |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_id            | String                | Cluster ID                                                                                                                                    |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_name          | String                | Current name                                                                                                                                  |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | create_at             | String                | Created at                                                                                                                                    |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | description           | String                | Release description                                                                                                                           |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | name                  | String                | Release name                                                                                                                                  |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | namespace             | String                | Namespace to which a chart release belongs                                                                                                    |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | parameters            | String                | Release parameters                                                                                                                            |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | resources             | String                | Resources required by the release                                                                                                             |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | status                | String                | Release status                                                                                                                                |
   |                       |                       |                                                                                                                                               |
   |                       |                       | -  **DEPLOYED**: The release is normal.                                                                                                       |
   |                       |                       | -  **DELETED**: The release has been deleted.                                                                                                 |
   |                       |                       | -  **FAILED**: The release fails to be deployed.                                                                                              |
   |                       |                       | -  **DELETING**: The release is being deleted.                                                                                                |
   |                       |                       | -  **PENDING_INSTALL**: The release is waiting to be installed.                                                                               |
   |                       |                       | -  **PENDING_UPGRADE**: The release is waiting to be upgraded.                                                                                |
   |                       |                       | -  **PENDING_ROLLBACK**: The release is waiting for rollback.                                                                                 |
   |                       |                       | -  **UNKNOWN**: The release status is unknown, indicating that the release is abnormal. You can manually delete the release and reinstall it. |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | status_description    | String                | Release status description                                                                                                                    |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | update_at             | String                | Updated at                                                                                                                                    |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | values                | String                | Release value                                                                                                                                 |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | version               | Integer               | Release version                                                                                                                               |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+

Example Requests
----------------

.. code-block:: text

   POST /cce/cam/v3/clusters/{cluster_id}/releases

   {
     "name" : "nino21",
     "namespace" : "project01",
     "version" : "1.0.0",
     "chart_id" : "3c138b72-7ce4-6d76-7c55-604cdb2ce423",
     "values" : {
       "imageTag" : "v2",
       "imagePullPolicy" : "IfNotPresent"
     },
     "parameters" : {
       "dry_run" : false,
       "no_hooks" : false,
       "replace" : false,
       "name_template" : ""
     }
   }

Example Responses
-----------------

**Status code: 201**

Created

.. code-block::

   {
     "chart_name" : "magento-mysql",
     "chart_public" : false,
     "chart_version" : "1.0.0",
     "cluster_id" : "a870253f-5dc7-11ee-bf71-0255ac100b03",
     "cluster_name" : "sfs-turbo-test",
     "create_at" : "2023-11-14T20:30:57+08:00",
     "description" : "Initial install underway",
     "name" : "testwww",
     "namespace" : "monitoring",
     "parameters" : "",
     "resources" : "",
     "status" : "PENDING_INSTALL",
     "status_description" : "Initial install underway",
     "update_at" : "2023-11-14T20:30:57+08:00",
     "values" : "{\"basic\":{\"admin_password\":\"******\",\"admin_username\":\"username\",\"app_name\":\"magento\",\"mysql_database\":\"magento\",\"mysql_name\":\"mysql\",\"mysql_password\":\"******\",\"mysql_port\":3306,\"mysql_root_password\":\"******\",\"mysql_user\":\"magento\",\"storage_class\":\"csi-nas\",\"storage_mode\":\"ReadWriteMany\",\"storage_size\":\"10G\"},\"global\":{\"magento_EIP\":\"100.100.100.100\",\"magento_EPORT\":32080,\"namespace\":\"default\"},\"image\":{\"magento_image\":\"example.com/everest/magento:latest\",\"mysql_image\":\"example.com/everest/mysql:5.7.14\"}}",
     "version" : 1
   }

Status Codes
------------

=========== ===========
Status Code Description
=========== ===========
201         Created
=========== ===========

Error Codes
-----------

See :ref:`Error Codes <cce_02_0250>`.
