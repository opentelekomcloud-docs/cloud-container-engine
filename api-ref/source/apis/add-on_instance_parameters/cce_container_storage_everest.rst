:original_name: cce_02_0408.html

.. _cce_02_0408:

CCE Container Storage (Everest)
===============================

Add-on Overview
---------------

The CCE Container Storage (Everest) add-on uses the Container Storage Interface (CSI) to link Kubernetes clusters with cloud storage services.

Add-on Parameters
-----------------

.. table:: **Table 1** Parameters

   +-----------+-----------+----------------------------------------------------------------------------------------+-------------------------------------------------------------------+
   | Parameter | Mandatory | Type                                                                                   | Description                                                       |
   +===========+===========+========================================================================================+===================================================================+
   | basic     | No        | object                                                                                 | Basic configuration parameters, which do not need to be specified |
   +-----------+-----------+----------------------------------------------------------------------------------------+-------------------------------------------------------------------+
   | flavor    | Yes       | :ref:`Table 2 <cce_02_0408__en-us_topic_0000001787887810_table8149147344>` object      | Flavor parameters                                                 |
   +-----------+-----------+----------------------------------------------------------------------------------------+-------------------------------------------------------------------+
   | custom    | Yes       | :ref:`Table 3 <cce_02_0408__en-us_topic_0000001787887810_table109631116113412>` object | Custom parameters                                                 |
   +-----------+-----------+----------------------------------------------------------------------------------------+-------------------------------------------------------------------+

.. _cce_02_0408__en-us_topic_0000001787887810_table8149147344:

.. table:: **Table 2** Configuration of flavor

   +-------------+-----------+---------------------------------------------------------------------------------------+---------------------------------------------+
   | Parameter   | Mandatory | Type                                                                                  | Description                                 |
   +=============+===========+=======================================================================================+=============================================+
   | description | No        | String                                                                                | Add-on description                          |
   +-------------+-----------+---------------------------------------------------------------------------------------+---------------------------------------------+
   | name        | Yes       | String                                                                                | Add-on specification name                   |
   +-------------+-----------+---------------------------------------------------------------------------------------+---------------------------------------------+
   | replicas    | Yes       | String                                                                                | Number of pods. The default value is **1**. |
   +-------------+-----------+---------------------------------------------------------------------------------------+---------------------------------------------+
   | resources   | Yes       | :ref:`resources <cce_02_0408__en-us_topic_0000001787887810_table136520220346>` object | Container resource (CPU and memory) quotas  |
   +-------------+-----------+---------------------------------------------------------------------------------------+---------------------------------------------+

.. _cce_02_0408__en-us_topic_0000001787887810_table109631116113412:

.. table:: **Table 3** Configuration of custom

   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                          | Mandatory       | Type                                                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   +====================================+=================+=========================================================================================+===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | default_vpc_id                     | Yes             | String                                                                                  | VPC ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_id                         | Yes             | String                                                                                  | Cluster ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_name                       | Yes             | String                                                                                  | Cluster name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | project_id                         | Yes             | String                                                                                  | Project ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | disable_auto_mount_secret          | No              | bool                                                                                    | Whether to allow the default AK/SK to be used during OBS volume mounting                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **false**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | over_subscription                  | No              | String                                                                                  | Local PV overcommitment ratio                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **80**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | csi_attacher_detach_worker_threads | No              | String                                                                                  | The number of concurrent workers for detaching volumes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **60**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | volume_attaching_flow_ctrl         | No              | String                                                                                  | Attaching flow control data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **0**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | number_of_reserved_disks           | No              | String                                                                                  | Disk attaching capability reserved for non-container scenarios                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **6**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | flow_control                       | No              | Map<String>string                                                                       | Flow control parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **{}**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | enable_node_attacher               | No              | bool                                                                                    | Whether to start agent attacher                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                    |                 |                                                                                         | Default value: **false**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | multiAZEnabled                     | No              | bool                                                                                    | Whether to enable the forcible mode of multi-AZ deployment for the deployment component. The default value is **false**. Deployment pods of the add-on will be forcibly scheduled to nodes in different AZs. If there are fewer AZs than pods, the extra pods will fail to run. If both **multiAZEnable** and **multiAZBalance** are set to true, the settings of **multiAZBalance** take effect, which means, the equivalent mode of multi-AZ deployment is used.                                                                                        |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | multiAZBalance                     | No              | bool                                                                                    | Whether to enable the equivalent mode of multi-AZ deployment for the deployment component. The default value is **false**. Deployment pods of the add-on are evenly scheduled to the nodes in the cluster in each AZ. If a new AZ is added, it is recommended that you increase add-on pods for cross-AZ HA deployment. With the equivalent multi-AZ deployment, the difference between the number of add-on pods in different AZs will be less than or equal to 1. If resources in one of the AZs are insufficient, pods cannot be scheduled to that AZ. |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | tolerations                        | No              | Array of :ref:`Table 5 <cce_02_0408__en-us_topic_0000001787887810_table1347114825310>`  | Toleration configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | node_match_expressions             | No              | Array of :ref:`Table 6 <cce_02_0408__en-us_topic_0000001787887810_table31791231173618>` | Add-on pod affinity configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +------------------------------------+-----------------+-----------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _cce_02_0408__en-us_topic_0000001787887810_table136520220346:

.. table:: **Table 4** Data structure of the resources field

   +-------------+-----------+--------+------------------------------------------------------------------------------------------+
   | Parameter   | Mandatory | Type   | Description                                                                              |
   +=============+===========+========+==========================================================================================+
   | limitsCpu   | Yes       | String | CPU size limit (unit: m)                                                                 |
   +-------------+-----------+--------+------------------------------------------------------------------------------------------+
   | limitsMem   | Yes       | String | Memory size limit (unit: Mi)                                                             |
   +-------------+-----------+--------+------------------------------------------------------------------------------------------+
   | name        | Yes       | String | Add-on name. The value is fixed at **everest-csi-controller** or **everest-csi-driver**. |
   +-------------+-----------+--------+------------------------------------------------------------------------------------------+
   | requestsCpu | Yes       | String | Requested CPU size (unit: m)                                                             |
   +-------------+-----------+--------+------------------------------------------------------------------------------------------+
   | requestsMem | Yes       | String | Requested memory size (unit: Mi)                                                         |
   +-------------+-----------+--------+------------------------------------------------------------------------------------------+

.. _cce_02_0408__en-us_topic_0000001787887810_table1347114825310:

.. table:: **Table 5** Taints and tolerations

   ================= ========= ====== ======================
   Parameter         Mandatory Type   Description
   ================= ========= ====== ======================
   key               No        String Taint key
   effect            No        String Taint policy
   operator          No        String Operator
   tolerationSeconds No        Int    Toleration time window
   ================= ========= ====== ======================

.. _cce_02_0408__en-us_topic_0000001787887810_table31791231173618:

.. table:: **Table 6** nodeMatchExpresssion node affinity

   ========= ========= ============ ==================
   Parameter Mandatory Type         Description
   ========= ========= ============ ==================
   key       No        String       Taint key
   values    No        List<String> Node affinity name
   operator  No        String       Operator
   ========= ========= ============ ==================

Example Request
---------------

.. code-block::

   {
     "kind": "Addon",
     "apiVersion": "v3",
     "metadata": { "annotations": { "addon.install/type": "install" } },
     "spec": {
       "clusterID": "cea63ae5-df9b-11ee-9f27-0255ac1001b2",
       "version": "2.4.4",
       "addonTemplateName": "everest",
       "values": {
         "basic": {
           "bms_url": "bms.***.com",
           "driver_init_image_version": "2.4.4",
           "ecsEndpoint": "https://ecs.***.com",
           "everest_image_version": "2.4.4",
           "evs_url": "evs.***.com",
           "iam_url": "iam.***.com",
           "ims_url": "ims.***.com",
           "obs_url": "obs.***.com",
           "platform": "linux-amd64",
           "sfs30_url": "obs.***.com",
           "sfs_turbo_url": "sfs-turbo.***.com",
           "sfs_url": "sfs.***.com",
           "supportHcs": false,
           "swr_addr": "swr.***.com",
           "swr_user": "hwofficial",
           "rbac_enabled": true,
           "cluster_version": "v1.23"
         },
         "flavor": {
           "description": "High avaiable",
           "is_default": true,
           "name": "HA50",
           "recommend_cluster_flavor_types": ["small"],
           "replicas": 2,
           "resources": [
             {
               "limitsCpu": "250m",
               "limitsMem": "600Mi",
               "name": "everest-csi-controller",
               "requestsCpu": "250m",
               "requestsMem": "600Mi"
             },
             {
               "limitsCpu": "300m",
               "limitsMem": "300Mi",
               "name": "everest-csi-driver",
               "requestsCpu": "300m",
               "requestsMem": "300Mi"
             }
           ],
           "category": ["CCE", "Turbo"]
         },
         "custom": {
           "annotations": {},
           "cluster_id": "",
           "cluster_name": "",
           "csi_attacher_detach_worker_threads": "60",
           "csi_attacher_worker_threads": "60",
           "default_vpc_id": "",
           "disable_auto_mount_secret": false,
           "enable_node_attacher": false,
           "flow_control": {},
           "multiAZBalance": false,
           "multiAZEnabled": false,
           "node_match_expressions": [],
           "number_of_reserved_disks": "6",
           "over_subscription": "80",
           "project_id": "",
           "tolerations": [
             {
               "key": "node.kubernetes.io/not-ready",
               "operator": "Exists",
               "effect": "NoExecute",
               "tolerationSeconds": 60
             },
             {
               "key": "node.kubernetes.io/unreachable",
               "operator": "Exists",
               "effect": "NoExecute",
               "tolerationSeconds": 60
             }
           ],
           "volume_attaching_flow_ctrl": "0"
         }
       }
     }
   }
