:original_name: cce_10_0363.html

.. _cce_10_0363:

Creating a Node
===============

Prerequisites
-------------

-  At least one cluster has been created.
-  A key pair has been created for identity authentication upon remote node login.

Constraints
-----------

-  The node has at least 2 vCPUs and 4 GiB of memory.
-  To ensure node stability, a certain number of CCE node resources will be reserved for Kubernetes components (such as kubelet, kube-proxy, and docker) based on the node specifications. Therefore, the total number of node resources and the number of allocatable node resources for your cluster are different. The larger the node specifications, the more the containers deployed on the node. Therefore, more node resources need to be reserved to run Kubernetes components. For details, see :ref:`Node Resource Reservation Policy <cce_10_0178>`.
-  Networks including VM networks and container networks of nodes are all managed by CCE. Do not add or delete ENIs or change routes. Otherwise, services may be unavailable. For example, the NIC named **gw_11cbf51a@eth0** on the node is the container network gateway and cannot be modified.
-  During the node creation, software packages are downloaded from OBS using the domain name. A private DNS server must be used to resolve the OBS domain name. Therefore, the DNS server address of the subnet where the node resides must be set to the private DNS server address so that the node can access the private DNS server. When you create a subnet, the private DNS server is used by default. If you change the subnet DNS, ensure that the DNS server in use can resolve the OBS domain name.
-  Once a node is created, its AZ cannot be changed.

Procedure
---------

After a cluster is created, you can create nodes for the cluster.

#. Log in to the CCE console.

#. In the navigation pane of the CCE console, choose **Clusters**. Click the target cluster name to access its details page.

#. In the navigation pane, choose **Nodes**. On the page displayed, click the **Nodes** tab and then **Create Node** in the upper right corner. Configure node parameters.

   **Compute Settings**

   You can configure the specifications and OS of a cloud server, on which your containerized applications run.

   .. table:: **Table 1** Configuration parameters

      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                              |
      +===================================+==========================================================================================================================================================================================================================================+
      | AZ                                | AZ where the node is located. Nodes in a cluster can be created in different AZs for higher reliability. The value cannot be changed after the node is created.                                                                          |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | Select **Random** to deploy your node in a random AZ based on the selected node flavor.                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | An AZ is a physical region where resources use independent power supply and networks. AZs are physically isolated but interconnected through an internal network. To enhance workload availability, create nodes in different AZs.       |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node Type                         | CCE standard cluster:                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  ECS (VM): Containers run on ECSs.                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | CCE Turbo cluster:                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  ECS (VM): Containers run on ECSs. Only the ECSs that can be bound with multiple NICs are supported.                                                                                                                                   |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container Engine                  | CCE clusters support Docker and containerd in some scenarios.                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  VPC network clusters of v1.23 and later versions support containerd. Tunnel network clusters of v1.23.2-r0 and later versions support containerd.                                                                                     |
      |                                   | -  For a CCE Turbo cluster, both **Docker** and **containerd** are supported. For details, see :ref:`Mapping between Node OSs and Container Engines <cce_10_0462__section159298451879>`.                                                 |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Specifications                    | Select node specifications that best fit your service needs.                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | The available node flavors vary depending on AZs. Obtain the flavors displayed on the console.                                                                                                                                           |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | OS                                | Select an OS type. Different types of nodes support different OSs.                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  **Public image**: Select a public image for the node.                                                                                                                                                                                 |
      |                                   | -  **Private image**: Select a private image for the node.                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | .. note::                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   |    -  Service container runtimes share the kernel and underlying calls of nodes. To ensure compatibility, select a Linux distribution version that is the same as or close to that of the final service container image for the node OS. |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node Name                         | Name of the node. When nodes (ECSs) are created in batches, the value of this parameter is used as the name prefix for each ECS.                                                                                                         |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | The system generates a default name for you, which can be modified.                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | A node name must start with a lowercase letter and cannot end with a hyphen (-). Only digits, lowercase letters, and hyphens (-) are allowed.                                                                                            |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Login Mode                        | -  **Key Pair**                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   |    Select the key pair used to log in to the node. You can select a shared key.                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   |    A key pair is used for identity authentication when you remotely log in to a node. If no key pair is available, click **Create Key Pair**.                                                                                            |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   **Storage Settings**

   Configure storage resources on a node for the containers running on it. Set the disk size according to site requirements.

   .. table:: **Table 2** Configuration parameters

      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
      +===================================+======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
      | System Disk                       | System disk used by the node OS. The value ranges from 40 GiB to 1024 GiB. The default value is 50 GiB.                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | **Encryption**: System disk encryption safeguards your data. Snapshots generated from encrypted disks and disks created using these snapshots automatically inherit the encryption setting. **This function is available only in certain regions.**                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Encryption** is not selected by default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   | -  After selecting **Encryption**, you can select an existing key in the displayed dialog box. If no key is available, click **View Key List** and create a key. After the key is created, click the refresh icon next to the **Encryption** text box.                                                                                                                                                                                                                                                                                               |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Data Disk                         | **At least one data disk is required** for the container runtime and kubelet. **The data disk cannot be deleted or uninstalled. Otherwise, the node will be unavailable.**                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  First data disk: used for container runtime and kubelet components. The value ranges from 20 GiB to 32,768 GiB. The default value is 100 GiB.                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | -  Other data disks: You can set the data disk size to a value ranging from 10 GiB to 32,768 GiB. The default value is 100 GiB.                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    If the node flavor is disk-intensive or ultra-high I/O, one data disk can be a local disk.                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    Local disks may break down and do not ensure data reliability. Store your service data in EVS disks, which are more reliable than local disks.                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | **Advanced Settings**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | Click **Expand** to configure the following parameters:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Data Disk Space Allocation**: After selecting **Set Container Engine Space**, you can specify the proportion of the space for the container engine, image, and temporary storage on the data disk. The container engine space is used to store the working directory, container image data, and image metadata for the container runtime. The remaining space of the data disk is used for pod configuration files, keys, and EmptyDir. For details about how to allocate data disk space, see :ref:`Data Disk Space Allocation <cce_10_0341>`. |
      |                                   | -  **Encryption**: Data disk encryption safeguards your data. Snapshots generated from encrypted disks and disks created using these snapshots automatically inherit the encryption setting. **This function is available only in certain regions.**                                                                                                                                                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    -  **Encryption** is not selected by default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    -  After selecting **Encryption**, you can select an existing key in the displayed dialog box. If no key is available, click **View Key List** and create a key. After the key is created, click the refresh icon next to the **Encryption** text box.                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | **Adding Multiple Data Disks**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | A maximum of four data disks can be added. By default, raw disks are created without any processing. You can also click **Expand** and select any of the following options:                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Default**: By default, a raw disk is created without any processing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  **Mount Disk**: The data disk is attached to a specified directory.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | -  **Use as PV**: applicable to scenarios in which there is a high performance requirement on PVs. The **node.kubernetes.io/local-storage-persistent** label is added to the node with PV configured. The value is **linear** or **striped**.                                                                                                                                                                                                                                                                                                        |
      |                                   | -  **Use as ephemeral volume**: applicable to scenarios in which there is a high performance requirement on EmptyDir.                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    -  Local PVs are supported only when the cluster version is v1.21.2-r0 or later and the Everest add-on version is 2.1.23 or later. Version 2.1.23 or later is recommended.                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   |    -  Local EVs are supported only when the cluster version is v1.21.2-r0 or later and the Everest add-on version is 1.2.29 or later.                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | :ref:`Local Persistent Volumes <cce_10_0391>` and :ref:`Local EVs <cce_10_0726>` support the following write modes:                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Linear**: A linear logical volume integrates one or more physical volumes. Data is written to the next physical volume when the previous one is used up.                                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   | -  **Striped**: A striped logical volume stripes data into blocks of the same size and stores them in multiple physical volumes in sequence, allowing data to be concurrently read and written. A storage pool consisting of striped volumes cannot be scaled-out. This option can be selected only when multiple volumes exist.                                                                                                                                                                                                                     |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   **Network Settings**

   Configure networking resources to allow node and containerized application access.

   .. table:: **Table 3** Configuration parameters

      +-----------------------------------+-------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                 |
      +===================================+=============================================================================================================+
      | Node Subnet                       | The node subnet selected during cluster creation is used by default. You can choose another subnet instead. |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------+
      | Node IP Address                   | IP address of the specified node. By default, the value is randomly allocated.                              |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------+
      | EIP                               | An ECS without a bound EIP cannot access the Internet or be accessed by public networks.                    |
      |                                   |                                                                                                             |
      |                                   | The default value is **Do not use**. **Use existing** and **Auto create** are supported.                    |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------+

   **Advanced Settings**

   Configure advanced node capabilities such as labels, taints, and startup command.

   .. table:: **Table 4** Advanced configuration parameters

      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                    |
      +===================================+================================================================================================================================================================================================================================================================+
      | Kubernetes Label                  | A key-value pair added to a Kubernetes object (such as a pod). A maximum of 20 labels can be added.                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | Labels can be used to distinguish nodes. With workload affinity settings, container pods can be scheduled to a specified node. For more information, see `Labels and Selectors <https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/>`__. |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Resource Tag                      | You can add resource tags to classify resources.                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | You can create **predefined tags** on the TMS console. The predefined tags are available to all resources that support tags. You can use predefined tags to improve the tag creation and resource migration efficiency.                                        |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | CCE will automatically create the "CCE-Dynamic-Provisioning-Node=\ *node id*" tag.                                                                                                                                                                             |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Taint                             | This parameter is left blank by default. You can add taints to configure anti-affinity for the node. A maximum of 20 taints are allowed for each node. Each taint contains the following parameters:                                                           |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | -  **Key**: A key must contain 1 to 63 characters, starting with a letter or digit. Only letters, digits, hyphens (-), underscores (_), and periods (.) are allowed. A DNS subdomain name can be used as the prefix of a key.                                  |
      |                                   | -  **Value**: A value must start with a letter or digit and can contain a maximum of 63 characters, including letters, digits, hyphens (-), underscores (_), and periods (.).                                                                                  |
      |                                   | -  **Effect**: Available options are **NoSchedule**, **PreferNoSchedule**, and **NoExecute**.                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | For details, see :ref:`Managing Node Taints <cce_10_0352>`.                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | .. note::                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   |    For a cluster of v1.19 or earlier, the workload may have been scheduled to a node before the taint is added. To avoid such a situation, select a cluster of v1.19 or later.                                                                                 |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Max. Pods                         | Maximum number of pods that can run on the node, including the default system pods.                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | This limit prevents the node from being overloaded with pods.                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | This number is also decided by other factors. For details, see :ref:`Maximum Number of Pods That Can Be Created on a Node <cce_10_0348>`.                                                                                                                      |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | ECS Group                         | An ECS group logically groups ECSs. The ECSs in the same ECS group comply with the same policy associated with the ECS group.                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | **Anti-affinity**: ECSs in an ECS group are deployed on different physical hosts to improve service reliability.                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | Select an existing ECS group, or click **Add ECS Group** to create one. After the ECS group is created, click the refresh button.                                                                                                                              |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Pre-installation Command          | Enter commands. A maximum of 1000 characters are allowed.                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | The script will be executed before Kubernetes software is installed. Note that if the script is incorrect, Kubernetes software may fail to be installed.                                                                                                       |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Post-installation Command         | Enter commands. A maximum of 1000 characters are allowed.                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | The script will be executed after Kubernetes software is installed, which does not affect the installation.                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | .. note::                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   |    Do not run the **reboot** command in the post-installation script to restart the system immediately. To restart the system, run the **shutdown -r 1** command to restart with a delay of one minute.                                                        |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Agency                            | An agency is created by the account administrator on the IAM console. By creating an agency, you can share your cloud server resources with another account, or entrust a more professional person or team to manage your resources.                           |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | If no agency is available, click **Create Agency** on the right to create one.                                                                                                                                                                                 |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. Configure the number of nodes to be purchased. Then, click **Next: Confirm**. Confirm the configured parameters and specifications.

#. Click **Submit**.

   The node list page is displayed. If the node status is **Running**, the node is created successfully. It takes about 6 to 10 minutes to create a node.

#. Click **Back to Node List**. The node is created successfully if it changes to the **Running** state.
