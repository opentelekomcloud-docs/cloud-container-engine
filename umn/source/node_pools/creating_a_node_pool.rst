:original_name: cce_10_0012.html

.. _cce_10_0012:

Creating a Node Pool
====================

Scenario
--------

This section describes how to create a node pool and perform operations on the node pool. For details about how a node pool works, see :ref:`Node Pool Overview <cce_10_0081>`.

Constraints
-----------

-  The Autoscaler add-on needs to be installed for node auto scaling. For details about the add-on installation and parameter configuration, see :ref:`CCE Cluster Autoscaler <cce_10_0154>`.

Procedure
---------

#. Log in to the CCE console.

#. Click the cluster name to access the cluster console. Choose **Nodes** in the navigation pane and click the **Node Pools** tab on the right.

#. In the upper right corner of the page, click **Create Node Pool**.

   **Basic Settings**

   .. table:: **Table 1** Basic settings

      +----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter      | Description                                                                                                                                                                           |
      +================+=======================================================================================================================================================================================+
      | Node Pool Name | Name of a node pool. By default, the name is in the format of *Cluster name*-nodepool-*Random number*. If you do not want to use the default name format, you can customize the name. |
      +----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Nodes          | Number of nodes to be created in this node pool. A maximum of 50 nodes that can be created at a time.                                                                                 |
      +----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   **Compute Settings**

   You can configure the flavor and OS of a cloud server, on which your containerized applications run.

   .. table:: **Table 2** Compute parameters

      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                              |
      +===================================+==========================================================================================================================================================================================================================================+
      | AZ                                | AZ where the node is located. Nodes in a cluster can be created in different AZs for higher reliability. The value cannot be changed after the node is created.                                                                          |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | You are advised to select **Random** to deploy your node in a random AZ based on the selected node flavor.                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | An AZ is a physical region where resources use independent power supply and networks. AZs are physically isolated but interconnected through an internal network. To enhance workload availability, create nodes in different AZs.       |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node Type                         | CCE standard cluster:                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  ECS (VM): Containers run on ECSs.                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | CCE Turbo cluster:                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  ECS (VM): Containers run on ECSs. Only the ECSs that can be bound with multiple NICs are supported.                                                                                                                                   |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container Engine                  | CCE clusters support Docker and containerd in some scenarios.                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  VPC network clusters of v1.23 and later versions support containerd. Tunnel network clusters of v1.23.2-r0 and later versions support containerd.                                                                                     |
      |                                   | -  For a CCE Turbo cluster, both **Docker** and **containerd** are supported. For details, see :ref:`Mapping between Node OSs and Container Engines <cce_10_0462__section159298451879>`.                                                 |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Specifications                    | Select a node flavor based on service requirements. The available node flavors vary depending on regions or AZs. For details, see the CCE console.                                                                                       |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | OS                                | Select an OS type. Different types of nodes support different OSs.                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | -  **Public image**: Select a public image for the node.                                                                                                                                                                                 |
      |                                   | -  **Private image**: Select a private image for the node.                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   | .. note::                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   |    -  Service container runtimes share the kernel and underlying calls of nodes. To ensure compatibility, select a Linux distribution version that is the same as or close to that of the final service container image for the node OS. |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Login Mode                        | -  **Key Pair**                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   |    Select the key pair used to log in to the node. You can select a shared key.                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                          |
      |                                   |    A key pair is used for identity authentication when you remotely log in to a node. If no key pair is available, click **Create Key Pair**.                                                                                            |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   **Storage Settings**

   Configure storage resources on a node for the containers running on it. Set the disk size according to site requirements.

   .. table:: **Table 3** Configuration parameters

      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
      +===================================+======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
      | System Disk                       | System disk used by the node OS. The value ranges from 40 GiB to 1024 GiB. The default value is 50 GiB.                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | **Encryption**: System disk encryption safeguards your data. Snapshots generated from encrypted disks and disks created using these snapshots automatically inherit the encryption setting. **This function is available only in certain regions.**                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Encryption** is not selected by default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   | -  After selecting **Encryption**, you can select an existing key in the displayed dialog box. If no key is available, click **View Key List** and create a key. After the key is created, click the refresh icon next to the **Encryption** text box.                                                                                                                                                                                                                                                                                               |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Data Disk                         | **At least one data disk is required** for the container runtime and kubelet. **The data disk cannot be deleted or uninstalled. Otherwise, the node will be unavailable.**                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  First data disk: used for container runtime and kubelet components. The value ranges from 20 GiB to 32,768 GiB. The default value is 100 GiB.                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | -  Other data disks: You can set the data disk size to a value ranging from 10 GiB to 32,768 GiB. The default value is 100 GiB.                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    If the node flavor is disk-intensive or ultra-high I/O, one data disk can be a local disk.                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    Local disks may break down and do not ensure data reliability. Store your service data in EVS disks, which are more reliable than local disks.                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | **Advanced Settings**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | Click **Expand** to configure the following parameters:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Data Disk Space Allocation**: After selecting **Set Container Engine Space**, you can specify the proportion of the space for the container engine, image, and temporary storage on the data disk. The container engine space is used to store the working directory, container image data, and image metadata for the container runtime. The remaining space of the data disk is used for pod configuration files, keys, and EmptyDir. For details about how to allocate data disk space, see :ref:`Data Disk Space Allocation <cce_10_0341>`. |
      |                                   | -  **Encryption**: Data disk encryption safeguards your data. Snapshots generated from encrypted disks and disks created using these snapshots automatically inherit the encryption setting. **This function is available only in certain regions.**                                                                                                                                                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    -  **Encryption** is not selected by default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    -  After selecting **Encryption**, you can select an existing key in the displayed dialog box. If no key is available, click **View Key List** and create a key. After the key is created, click the refresh icon next to the **Encryption** text box.                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | **Adding Multiple Data Disks**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | A maximum of four data disks can be added. By default, raw disks are created without any processing. You can also click **Expand** and select any of the following options:                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Default**: By default, a raw disk is created without any processing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  **Mount Disk**: The data disk is attached to a specified directory.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | -  **Use as PV**: applicable to scenarios in which there is a high performance requirement on PVs. The **node.kubernetes.io/local-storage-persistent** label is added to the node with PV configured. The value is **linear** or **striped**.                                                                                                                                                                                                                                                                                                        |
      |                                   | -  **Use as ephemeral volume**: applicable to scenarios in which there is a high performance requirement on EmptyDir.                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |    -  Local PVs are supported only when the cluster version is v1.21.2-r0 or later and the Everest add-on version is 2.1.23 or later. Version 2.1.23 or later is recommended.                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   |    -  Local EVs are supported only when the cluster version is v1.21.2-r0 or later and the Everest add-on version is 1.2.29 or later.                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | :ref:`Local Persistent Volumes <cce_10_0391>` and :ref:`Local EVs <cce_10_0726>` support the following write modes:                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   | -  **Linear**: A linear logical volume integrates one or more physical volumes. Data is written to the next physical volume when the previous one is used up.                                                                                                                                                                                                                                                                                                                                                                                        |
      |                                   | -  **Striped**: A striped logical volume stripes data into blocks of the same size and stores them in multiple physical volumes in sequence, allowing data to be concurrently read and written. A storage pool consisting of striped volumes cannot be scaled-out. This option can be selected only when multiple volumes exist.                                                                                                                                                                                                                     |
      +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   **Network Settings**

   Configure networking resources to allow node and containerized application access.

   .. table:: **Table 4** Configuration parameters

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                          |
      +===================================+======================================================================================================================================================================================+
      | Node Subnet                       | The node subnet selected during cluster creation is used by default. You can choose another subnet instead.                                                                          |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node IP                           | Random allocation is supported.                                                                                                                                                      |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Associate Security Group          | Security group used by the nodes created in the node pool. A maximum of five security groups can be selected.                                                                        |
      |                                   |                                                                                                                                                                                      |
      |                                   | When a cluster is created, a node security group named **{Cluster name}-cce-node-{Random ID}** is created and used by default.                                                       |
      |                                   |                                                                                                                                                                                      |
      |                                   | Traffic needs to pass through certain ports in the node security group to ensure node communications. Ensure that you have enabled these ports if you select another security group. |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   **Advanced Settings**

   Configure advanced node capabilities such as labels, taints, and startup command.

   .. table:: **Table 5** Advanced configuration parameters

      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                    |
      +===================================+================================================================================================================================================================================================================================================================+
      | Kubernetes Label                  | A Kubernetes label is a key-value pair added to a Kubernetes object (such as a pod). After specifying a label, click **Add**. A maximum of 20 labels can be added.                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | Labels can be used to distinguish nodes. With workload affinity settings, container pods can be scheduled to a specified node. For more information, see `Labels and Selectors <https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/>`__. |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Resource Tag                      | You can add resource tags to classify resources.                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | You can create **predefined tags** on the TMS console. The predefined tags are available to all resources that support tags. You can use predefined tags to improve the tag creation and resource migration efficiency.                                        |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | CCE will automatically create the "CCE-Dynamic-Provisioning-Node=\ *Node ID*" tag.                                                                                                                                                                             |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Taint                             | This parameter is left blank by default. You can add taints to configure node anti-affinity. A maximum of 20 taints are allowed for each node. Each taint contains the following parameters:                                                                   |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | -  **Key**: A key must contain 1 to 63 characters starting with a letter or digit. Only letters, digits, hyphens (-), underscores (_), and periods (.) are allowed. A DNS subdomain name can be used as the prefix of a key.                                   |
      |                                   | -  **Value**: A value must start with a letter or digit and can contain a maximum of 63 characters, including letters, digits, hyphens (-), underscores (_), and periods (.).                                                                                  |
      |                                   | -  **Effect**: Available options are **NoSchedule**, **PreferNoSchedule**, and **NoExecute**.                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | For details, see :ref:`Managing Node Taints <cce_10_0352>`.                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | .. note::                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   |    For a cluster of v1.19 or earlier, the workload may have been scheduled to a node before the taint is added. To avoid such a situation, select a cluster of a version later than v1.19.                                                                     |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Max. Pods                         | Maximum number of pods that can run on the node, including the default system pods.                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | This limit prevents the node from being overloaded with pods.                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | This number is also decided by other factors. For details, see :ref:`Maximum Number of Pods That Can Be Created on a Node <cce_10_0348>`.                                                                                                                      |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | ECS Group                         | An ECS group logically groups ECSs. The ECSs in the same ECS group comply with the same policy associated with the ECS group.                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | Anti-affinity: ECSs in an ECS group are deployed on different physical hosts to improve service reliability.                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | Select an existing ECS group, or click **Add ECS Group** to create one. After the ECS group is created, click the refresh icon.                                                                                                                                |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Pre-installation Command          | Enter commands. A maximum of 1000 characters are allowed.                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | The script will be executed before Kubernetes software is installed. Note that if the script is incorrect, Kubernetes software may fail to be installed.                                                                                                       |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Post-installation Command         | Enter commands. A maximum of 1000 characters are allowed.                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | The script will be executed after Kubernetes software is installed, which does not affect the installation.                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | .. note::                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   |    Do not run the **reboot** command in the post-installation script to restart the system immediately. To restart the system, run the **shutdown -r 1** command to restart with a delay of one minute.                                                        |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Agency                            | An agency is created by the account administrator on the IAM console. By creating an agency, you can share your cloud server resources with another account, or entrust a more professional person or team to manage your resources.                           |
      |                                   |                                                                                                                                                                                                                                                                |
      |                                   | If no agency is available, click **Create Agency** to create one.                                                                                                                                                                                              |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. Click **Next: Confirm**.

#. Click **Submit**.
