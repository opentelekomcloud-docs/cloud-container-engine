:original_name: cce_10_0727.html

.. _cce_10_0727:

Updating an AS Configuration
============================

Auto Scaling (AS) enables elastic scaling of nodes in a node pool based on scaling policies. Without this function, you have to manually adjust the number of nodes in a node pool.

Constraints
-----------

To enable AS, the :ref:`CCE Cluster Autoscaler <cce_10_0154>` add-on must be installed in the target cluster.

Procedure
---------

#. Log in to the CCE console and click the cluster name to access the cluster console.

#. In the navigation pane, choose **Nodes**. On the **Node Pools** tab, locate the row containing the target node pool and click **Auto Scaling**.

   -  If the auto scaling add-on has not been installed, configure add-on parameters based on service requirements, click **Install**, and wait until the add-on is installed. For details about add-on configurations, see :ref:`CCE Cluster Autoscaler <cce_10_0154>`.
   -  If the auto scaling add-on has been installed, directly configure auto scaling policies.

#. Configure auto scaling policies.

   **AS Configuration**

   -  **Customize scale-out rules.**: Click **Add Rule**. In the dialog box displayed, configure parameters. You can add multiple node scaling rules, a maximum of one CPU usage-based rule, and one memory usage-based rule. The total number of rules cannot exceed 10.

      The following table lists custom rules.

      .. table:: **Table 1** Custom rules

         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Rule Type                         | Configuration                                                                                                                                                                                                                                                                                                                                                                                                           |
         +===================================+=========================================================================================================================================================================================================================================================================================================================================================================================================================+
         | Metric-based                      | -  **Trigger**: Select **CPU allocation rate** or **Memory allocation rate** and enter a value. The value must be greater than the scale-in percentage configured in the auto scaling add-on.                                                                                                                                                                                                                           |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |    .. note::                                                                                                                                                                                                                                                                                                                                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |       -  Resource allocation (%) = Resources requested by pods in the node pool/Resources allocatable to pods in the node pool                                                                                                                                                                                                                                                                                          |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |       -  **If multiple rules meet the conditions, the rules are executed in either of the following modes:**                                                                                                                                                                                                                                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |          If rules based on the **CPU allocation rate** and **memory allocation rate** are configured and two or more rules meet the scale-out conditions, the rule that will add the most nodes will be executed.                                                                                                                                                                                                       |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |          If a rule based on the **CPU allocation rate** and **a periodic rule** are configured and they both meet the scale-out conditions, one of them will be executed randomly. The rule executed first (rule A) changes the node pool to the scaling state. As a result, the other rule (rule B) cannot be executed. After rule A is executed and the node pool status becomes normal, rule B will not be executed. |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |       -  If rules based on the **CPU allocation rate** and **memory allocation rate** are configured, the policy detection period varies with the processing logic of each loop of the Autoscaler add-on. A scale-out is triggered once the conditions are met, but it is constrained by other factors such as the cooldown period and node pool status.                                                                |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |       -  When the number of nodes in the cluster reaches the upper limit, or the CPU or memory usage reaches the upper limit of the autoscaler add-on, node scale-out will not be triggered.                                                                                                                                                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   | -  **Action**: Configure an action to be performed when the triggering condition is met.                                                                                                                                                                                                                                                                                                                                |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |    -  **Custom**: Add a specified number of nodes to a node pool.                                                                                                                                                                                                                                                                                                                                                       |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |    -  **Auto calculation**: When the trigger condition is met, nodes are automatically added and the allocation rate is restored to a value lower than the threshold. The formula is as follows:                                                                                                                                                                                                                        |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |       Number of nodes to be added = [Resource request of pods in the node pool/(Available resources of a single node x Target allocation rate)] - Number of current nodes + 1                                                                                                                                                                                                                                           |
         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Periodic                          | -  **Trigger Time**: You can select a specific time every day, every week, every month, or every year.                                                                                                                                                                                                                                                                                                                  |
         |                                   | -  **Action**: specifies an action to be carried out when the trigger time is reached. A specified number of nodes will be added to the node pool.                                                                                                                                                                                                                                                                      |
         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   -  **Nodes**: The number of nodes in a node pool will always be within the range during auto scaling.

   -  **Cooldown Period**: a period during which the nodes added in the current node pool cannot be scaled in.

   **AS Object**

   **Specifications**: Configure whether to enable auto scaling for node flavors in a node pool.

#. Click **OK**.
