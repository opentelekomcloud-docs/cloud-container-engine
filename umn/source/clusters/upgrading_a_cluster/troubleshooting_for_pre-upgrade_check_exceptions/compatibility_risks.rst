:original_name: cce_10_0441.html

.. _cce_10_0441:

Compatibility Risks
===================

Check Items
-----------

Read the version compatibility differences and ensure that they are not affected. The patch upgrade does not involve version compatibility differences.

Version compatibility
---------------------

+-----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Upgrade Path          | Version Difference                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Self-Check                                                                                                                                        |
+=======================+===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+===================================================================================================================================================+
| v1.23 or v1.25        | Docker is no longer recommended. Use containerd instead. For details, see :ref:`Container Engines <cce_10_0462>`.                                                                                                                                                                                                                                                                                                                                                                                                 | This item has been included in the pre-upgrade check.                                                                                             |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                   |
| Upgraded to v1.27     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                   |
+-----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| v1.23 to v1.25        | Since Kubernetes v1.25, PodSecurityPolicy has been replaced by pod Security Admission. For details, see :ref:`Configuring Pod Security Admission <cce_10_0466>`.                                                                                                                                                                                                                                                                                                                                                  | -  To migrate PodSecurityPolicy capabilities to pod Security Admission, perform the following steps:                                              |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                   |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |    #. Ensure that the cluster is of the latest CCE v1.23 version.                                                                                 |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |    #. Migrate PodSecurityPolicy capabilities to pod Security Admission. For details, see :ref:`Configuring Pod Security Admission <cce_10_0466>`. |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |    #. After confirming that the functions are running properly after the migration, upgrade the CCE cluster to v1.25.                             |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                   |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | -  If you no longer need PodSecurityPolicy, delete PodSecurityPolicy from the cluster and upgrade the cluster to v1.25.                           |
+-----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| v1.19 to v1.21        | The bug of **exec probe timeouts** is fixed in Kubernetes 1.21. Before this bug is fixed, the exec probe does not consider the **timeoutSeconds** field. Instead, the probe will run indefinitely, even beyond its configured deadline. It will stop until the result is returned. If this field is not specified, the default value **1** is used. This field takes effect after the upgrade. If the probe runs over 1 second, the application health check may fail and the application may restart frequently. | Before the upgrade, check whether the timeout is properly set for the exec probe.                                                                 |
+-----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                       | kube-apiserver of CCE v1.19 or later requires that the Subject Alternative Names (SANs) field be configured for the certificate of your webhook server. Otherwise, kube-apiserver fails to call the webhook server after the upgrade, and containers cannot be started properly.                                                                                                                                                                                                                                  | Before the upgrade, check whether the SAN field is configured in the certificate of your webhook server.                                          |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                   |
|                       | Root cause: X.509 `CommonName <https://golang.google.cn/doc/go1.15#commonname>`__ is discarded in Go v1.15. kube-apiserver of CCE v1.19 is compiled using Go v1.15. If your webhook certificate does not have SANs, kube-apiserver does not process the **CommonName** field of the X.509 certificate as the host name by default. As a result, the authentication fails.                                                                                                                                         | -  If you do not have your own webhook server, you can skip this check.                                                                           |
|                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | -  If the field is not set, use the SAN field to specify the IP address and domain name supported by the certificate.                             |
+-----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 1** QoS class changes before and after the upgrade

   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Init Container (Calculated Based on spec.initContainers) | Service Container (Calculated Based on spec.containers) | Pod (Calculated Based on spec.containers and spec.initContainers) | Impacted or Not |
   +==========================================================+=========================================================+===================================================================+=================+
   | Guaranteed                                               | Besteffort                                              | Burstable                                                         | Yes             |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Guaranteed                                               | Burstable                                               | Burstable                                                         | No              |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Guaranteed                                               | Guaranteed                                              | Guaranteed                                                        | No              |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Besteffort                                               | Besteffort                                              | Besteffort                                                        | No              |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Besteffort                                               | Burstable                                               | Burstable                                                         | No              |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Besteffort                                               | Guaranteed                                              | Burstable                                                         | Yes             |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Burstable                                                | Besteffort                                              | Burstable                                                         | Yes             |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Burstable                                                | Burstable                                               | Burstable                                                         | No              |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
   | Burstable                                                | Guaranteed                                              | Burstable                                                         | Yes             |
   +----------------------------------------------------------+---------------------------------------------------------+-------------------------------------------------------------------+-----------------+
