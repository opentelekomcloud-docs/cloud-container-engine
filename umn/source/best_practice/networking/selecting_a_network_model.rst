:original_name: cce_bestpractice_00162.html

.. _cce_bestpractice_00162:

Selecting a Network Model
=========================

CCE uses proprietary, high-performance container networking add-ons to support the tunnel, Cloud Native 2.0, and VPC network models.

.. caution::

   After a cluster is created, the network model cannot be changed.

-  **Tunnel network**: The container network is an overlay tunnel network on top of a VPC network and uses the VXLAN technology. This network model is applicable when there is no high requirements on performance. VXLAN encapsulates Ethernet packets as UDP packets for tunnel transmission. Though at some cost of performance, the tunnel encapsulation enables higher interoperability and compatibility with advanced features (such as network policy-based isolation), meeting the requirements of most applications.


   .. figure:: /_static/images/en-us_image_0000002483958404.png
      :alt: **Figure 1** Container tunnel network

      **Figure 1** Container tunnel network

-  **VPC network**: The container network uses VPC routing to integrate with the underlying network. This network model is applicable to performance-intensive scenarios. The maximum number of nodes allowed in a cluster depends on the route quota in a VPC network. Each node is assigned a CIDR block of a fixed size. VPC networks are free from tunnel encapsulation overhead and outperform container tunnel networks. In addition, as VPC routing includes routes to node IP addresses and container network segment, container pods in the cluster can be directly accessed from outside the cluster.


   .. figure:: /_static/images/en-us_image_0000002483958400.png
      :alt: **Figure 2** VPC network

      **Figure 2** VPC network

-  **Cloud Native Network 2.0**: The container network deeply integrates the elastic network interface capability of VPC, uses the VPC CIDR block to allocate container addresses, and supports passthrough networking to pods through load balancers.


   .. figure:: /_static/images/en-us_image_0000002483958406.png
      :alt: **Figure 3** Cloud Native 2.0 network

      **Figure 3** Cloud Native 2.0 network

The following table lists the differences between the network models.

.. table:: **Table 1** Networking model comparison

   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Dimension                               | Tunnel Network                                                                                                                                                                                                                                                                                                                                                                                                                                 | VPC Network                                                                                                                                                                                                                                                                                                                                                   | Cloud Native 2.0 Network                                                                                                                                                                                                                                                                                      |
   +=========================================+================================================================================================================================================================================================================================================================================================================================================================================================================================================+===============================================================================================================================================================================================================================================================================================================================================================+===============================================================================================================================================================================================================================================================================================================+
   | Application scenario                    | -  Low requirements on performance: As a container tunnel network requires additional VXLAN tunnel encapsulation, it has about 5% to 15% of performance loss when compared with the other two container network models. Therefore, the container tunnel networks apply to the scenarios that do not have high performance requirements, such as web applications, and middle-end and back-end services with a small number of access requests. | -  High performance requirements: As no tunnel encapsulation is required, the VPC network model delivers the performance close to that of a VPC network when compared with the container tunnel network model. Therefore, the VPC network model applies to scenarios that have high requirements on performance, such as AI computing and big data computing. | -  High performance requirements: Cloud Native 2.0 networks use VPC networks to construct container networks, eliminating the need for tunnel encapsulation or NAT required by container communications. This makes Cloud Native 2.0 networks ideal for scenarios that demand high bandwidth and low latency. |
   |                                         | -  Large-scale networks: Different from a VPC network that is limited by the VPC route quota, a container tunnel network does not have any restriction on the infrastructure. In addition, the container tunnel network controls the broadcast domain to the node level and supports a maximum of 2000 nodes.                                                                                                                                  | -  Small- and medium-scale networks: Due to the limitation on VPC route tables, it is recommended that the number of nodes in a cluster be less than or equal to 1000.                                                                                                                                                                                        | -  Large-scale networks: A Cloud Native 2.0 network supports a maximum of 2000 ECS nodes and 100,000 pods.                                                                                                                                                                                                    |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Core technology                         | OVS                                                                                                                                                                                                                                                                                                                                                                                                                                            | IPvlan and VPC route                                                                                                                                                                                                                                                                                                                                          | VPC network interfaces/supplementary network interfaces                                                                                                                                                                                                                                                       |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Applicable cluster                      | CCE standard cluster                                                                                                                                                                                                                                                                                                                                                                                                                           | CCE standard cluster                                                                                                                                                                                                                                                                                                                                          | CCE Turbo cluster                                                                                                                                                                                                                                                                                             |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Container network isolation             | Pods support Kubernetes-native network policies.                                                                                                                                                                                                                                                                                                                                                                                               | Not supported                                                                                                                                                                                                                                                                                                                                                 | Pods support security group isolation.                                                                                                                                                                                                                                                                        |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Interconnecting pods to a load balancer | Interconnected through a NodePort                                                                                                                                                                                                                                                                                                                                                                                                              | Interconnected through a NodePort                                                                                                                                                                                                                                                                                                                             | Directly interconnected using a dedicated load balancer                                                                                                                                                                                                                                                       |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                               |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                               | Interconnected using a shared load balancer through a NodePort                                                                                                                                                                                                                                                |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Container IP address management         | -  Separate container CIDR blocks are needed. Container CIDR blocks cannot overlap with VPC CIDR blocks.                                                                                                                                                                                                                                                                                                                                       | -  Separate container CIDR blocks are needed. Container CIDR blocks cannot overlap with VPC CIDR blocks.                                                                                                                                                                                                                                                      | -  You can specify a VPC subnet as the container CIDR block.                                                                                                                                                                                                                                                  |
   |                                         | -  After a cluster is created, the container CIDR block cannot be expanded. To avoid insufficient IP addresses, you are advised to set the subnet mask of the container CIDR block to a maximum of 19 bits.                                                                                                                                                                                                                                    | -  You can add multiple container CIDR blocks.                                                                                                                                                                                                                                                                                                                | -  After a cluster is created, you can add more container CIDR blocks.                                                                                                                                                                                                                                        |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                | -  After a cluster is created, you can add more container CIDR blocks.                                                                                                                                                                                                                                                                                        | -  Container IP addresses are directly allocated from the VPC, consuming many IP addresses. You are advised to plan a large VPC CIDR block in advance.                                                                                                                                                        |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                | -  When container IP addresses are allocated, a fixed IP address range is configured for each node from the container CIDR block. The IP addresses of all pods on a node are allocated from the IP address range.                                                                                                                                             |                                                                                                                                                                                                                                                                                                               |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Maximum number of pods on a node        | It is determined by the maximum number of pods that can be created on a node (the kubelet parameter **maxPods**).                                                                                                                                                                                                                                                                                                                              | The smaller value between the following two options is used:                                                                                                                                                                                                                                                                                                  | The smaller value between the following two options is used:                                                                                                                                                                                                                                                  |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                               |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                | -  The maximum number of pods that can be created on a node (the kubelet parameter **maxPods**).                                                                                                                                                                                                                                                              | -  The maximum number of pods that can be created on a node (the kubelet parameter **maxPods**).                                                                                                                                                                                                              |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                | -  The number of container IP addresses reserved for each node.                                                                                                                                                                                                                                                                                               | -  The number of network interfaces on a node.                                                                                                                                                                                                                                                                |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Network performance                     | Performance loss due to VXLAN encapsulation                                                                                                                                                                                                                                                                                                                                                                                                    | No tunnel encapsulation, and cross-node traffic forwarded through VPC routers (The performance is so good that is comparable to that of the host network, but there is a loss caused by NAT.)                                                                                                                                                                 | Container network integrated with VPC network, eliminating performance loss                                                                                                                                                                                                                                   |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Network scale                           | A maximum of 2000 nodes is supported.                                                                                                                                                                                                                                                                                                                                                                                                          | Suitable for small- and medium-scale networks due to the limitation on VPC route tables. It is recommended that the number of nodes be less than or equal to 1000.                                                                                                                                                                                            | A maximum of 2000 nodes is supported.                                                                                                                                                                                                                                                                         |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                               |
   |                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                | Each time a node is added to the cluster, a route is added to the VPC route tables. Evaluate the cluster scale that is limited by the VPC route tables before creating the cluster.                                                                                                                                                                           | In a cluster that uses a Cloud Native 2.0 network, container IP addresses are assigned from the VPC CIDR block, and the number of containers is also restricted by this CIDR block. Evaluate the cluster's scale limitations before creating it.                                                              |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | IPv4/IPv6 dual-stack                    | Supported                                                                                                                                                                                                                                                                                                                                                                                                                                      | Not supported                                                                                                                                                                                                                                                                                                                                                 | Supported                                                                                                                                                                                                                                                                                                     |
   +-----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. important::

   #. The scale of a cluster that uses the VPC network model is limited by the custom routes of the VPC. Therefore, you need to estimate the number of required nodes before creating a cluster.
   #. The scale of a cluster that uses the Cloud Native Network 2.0 model depends on the size of the VPC subnet CIDR block selected for the network attachment definition. Before creating a cluster, evaluate the scale of your cluster.
   #. By default, VPC routing network supports direct communication between containers and hosts in the same VPC. If a peering connection policy is configured between the VPC and another VPC, the containers can directly communicate with hosts on the peer VPC. In addition, in hybrid networking scenarios such as Direct Connect and VPN, communication between containers and hosts on the peer end can also be achieved with proper planning.
