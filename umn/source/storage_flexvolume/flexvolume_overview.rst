:original_name: cce_01_0306.html

.. _cce_01_0306:

FlexVolume Overview
===================

In container storage, you can use different types of volumes and mount them to containers in pods as many as you want.

In CCE, container storage is backed both by Kubernetes-native objects, such as emptyDir/hostPath volumes, secrets, and ConfigMaps, and by storage services.

CCE clusters of **1.13 and earlier versions** use the :ref:`storage-driver <cce_01_0127>` add-on to connect to storage services to support Kubernetes FlexVolume driver for container storage. The FlexVolume driver has been deprecated in favor of the Container Storage Interface (CSI). **The everest add-on for CSI is installed in CCE clusters of 1.15 and later versions by default.** For details, see :ref:`Overview <cce_01_0307>`.

.. note::

   -  In CCE clusters earlier than Kubernetes 1.13, end-to-end capacity expansion of container storage is not supported, and the PVC capacity is inconsistent with the storage capacity.
   -  **In a cluster of v1.13 or earlier**, when an upgrade or bug fix is available for storage functionalities, you only need to install or upgrade the storage-driver add-on. Upgrading the cluster or creating a cluster is not required.

Notes and Constraints
---------------------

-  For clusters created in CCE, Kubernetes v1.15.11 is a transitional version in which the FlexVolume plug-in (:ref:`storage-driver <cce_01_0127>`) is compatible with the CSI plug-in (:ref:`everest <cce_01_0066>`). Clusters of v1.17 and later versions do not support FlexVolume any more. You need to use the everest add-on. For details about CSI and FlexVolume, see :ref:`Differences Between CSI and FlexVolume Plug-ins <cce_01_0306__section86752053123513>`.
-  The FlexVolume plug-in will be maintained by Kubernetes developers, but new functionality will only be added to CSI. You are advised not to create storage that connects to the FlexVolume plug-in (storage-driver) in CCE any more. Otherwise, the storage resources may not function normally.

.. _cce_01_0306__section86752053123513:

Differences Between CSI and FlexVolume Plug-ins
-----------------------------------------------

.. table:: **Table 1** CSI and FlexVolume

   +---------------------+-----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Kubernetes Solution | CCE Add-on      | Feature                                                                                                                                                                                                                                                                                                                                                                                                                                        | Usage                                                                                                                                                                                                                                                                   |
   +=====================+=================+================================================================================================================================================================================================================================================================================================================================================================================================================================================+=========================================================================================================================================================================================================================================================================+
   | CSI                 | everest         | CSI was developed as a standard for exposing arbitrary block and file storage storage systems to containerized workloads. Using CSI, third-party storage providers can deploy plugins exposing new storage systems in Kubernetes without having to touch the core Kubernetes code. In CCE, the everest add-on is installed by default in clusters of Kubernetes v1.15 and later to connect to storage services (EVS, OBS, SFS, and SFS Turbo). | The :ref:`everest <cce_01_0066>` add-on is installed by default in clusters of **v1.15 and later**. CCE will mirror the Kubernetes community by providing continuous support for updated CSI capabilities.                                                              |
   |                     |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                         |
   |                     |                 | The everest add-on consists of two parts:                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                         |
   |                     |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                         |
   |                     |                 | -  **everest-csi-controller** for storage volume creation, deletion, capacity expansion, and cloud disk snapshots                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                         |
   |                     |                 | -  **everest-csi-driver** for mounting, unmounting, and formatting storage volumes on nodes                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                         |
   |                     |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                         |
   |                     |                 | For details, see :ref:`everest <cce_01_0066>`.                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                         |
   +---------------------+-----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | FlexVolume          | storage-driver  | FlexVolume is an out-of-tree plugin interface that has existed in Kubernetes since version 1.2 (before CSI). CCE provided FlexVolume volumes through the storage-driver add-on installed in clusters of Kubernetes v1.13 and earlier versions. This add-on connects clusters to storage services (EVS, OBS, SFS, and SFS Turbo).                                                                                                               | For clusters of v1.13 or earlier that have been created, the installed FlexVolume plug-in (the storage-driver add-on in CCE) can still be used. CCE stops providing update support for this add-on, and you are advised to :ref:`upgrade these clusters <cce_01_0120>`. |
   |                     |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                         |
   |                     |                 | For details, see :ref:`storage-driver <cce_01_0127>`.                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                         |
   +---------------------+-----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. note::

   -  A cluster can use only one type of storage plug-ins.
   -  The FlexVolume plug-in cannot be replaced by the CSI plug-in in clusters of v1.13 or earlier. You can only upgrade these clusters. For details, see :ref:`Cluster Upgrade Between Major Versions <cce_01_0197__section16738338445>`.

Notice on Using Add-ons
-----------------------

-  To use the CSI plug-in (the :ref:`everest <cce_01_0066>` add-on in CCE), your cluster must be using **Kubernetes 1.15 or later**. This add-on is installed by default when you create a cluster of v1.15 or later. The FlexVolume plug-in (the :ref:`storage-driver <cce_01_0127>` add-on in CCE) is installed by default when you create a cluster of v1.13 or earlier.
-  If your cluster is upgraded from v1.13 to v1.15, :ref:`storage-driver <cce_01_0127>` is replaced by everest (v1.1.6 or later) for container storage. The takeover does not affect the original storage functions.
-  In version 1.2.0 of the everest add-on, **key authentication** is optimized when OBS is used. After the everest add-on is upgraded from a version earlier than 1.2.0, you need to restart all workloads that use OBS in the cluster. Otherwise, workloads may not be able to use OBS.

Checking Storage Add-ons
------------------------

#. Log in to the CCE console.
#. In the navigation tree on the left, click **Add-ons**.
#. Click the **Add-on Instance** tab.
#. Select a cluster in the upper right corner. The default storage add-on installed during cluster creation is displayed.
